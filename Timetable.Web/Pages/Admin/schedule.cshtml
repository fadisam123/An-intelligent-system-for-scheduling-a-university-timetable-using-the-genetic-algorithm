@page
@model Timetable.RazorWeb.Pages.Admin.scheduleModel
@{
}

<div class="container">
    <form method="post">

        <div class="form-group">
            @if (Model?.Semesters?.Count is null || Model?.Semesters?.Count == 0)
            {
                <div class="text-danger">لايوجد بيانات في كافية لتوليد البرنامج الرجاء إدخال المقررات ثم اسنادها إلى المدرسين ثم العودة إلى هنا</div>
            }
            else
            {
                <label asp-for="@Model.SelectedSemester" class="control-label ms-5"></label>
                <select asp-for="@Model.SelectedSemester" class="form-select w-25">
                    @foreach (var item in Model?.Semesters)
                    {
                        <option value="@item.SemesterNo">@item.SemesterNo</option>
                    }
                </select>
            }
        </div>

        <button onclick="return confirm('سيتم حذف برنامج الدوام القديم واستبداله بالبرنامج المولد، هل أنت متأكد من المتابعة؟')" class="edit-save-button generate" type="submit">توليد</button>
    </form>

    <form id="yearChangedForm" asp-page-handler="x" method="post">

        <div class="form-group">
            @if (Model?.Years?.Count is null || Model?.Years?.Count == 0)
            {

            }
            else
            {
                <label asp-for="@Model.SelectedYearInput" class="control-label"></label>
                <select onchange="$('#yearChangedForm').submit()" asp-for="@Model.SelectedYearInput" class="form-select w-25">
                    @foreach (var item in Model?.Years)
                    {
                        <option value="@item.YearNo">@item.YearNo</option>
                    }
                </select>
            }
            @if (Model?.Semesters?.Count is null || Model?.Semesters?.Count == 0)
            {

            }
            else
            {
                <label asp-for="@Model.SelectedSemesterInput" class="control-label"></label>
                <select onchange="$('#yearChangedForm').submit()" asp-for="@Model.SelectedSemesterInput" class="form-select w-25">
                    @foreach (var item in Model?.Semesters)
                    {
                        <option value="@item.SemesterNo">@item.SemesterNo</option>
                    }
                </select>
            }
        </div>

    </form>

    <button id="editSaveButton" class="edit-save-button generate" onclick="toggleEditSave()">تعديل</button>
</div>
<div class="butt">
    <button>حفظ</button>
    <button>توليد</button>
    <button id="editSaveButton" class="edit-save-button" onclick="toggleEditSave()">تعديل</button>
</div>
<br />
<br />

<table id="myTable">


    <tr>
        @foreach (var day in Model.Days)
        {
            <th>@day.Name</th>
        }
        <th>الوقت</th>
    </tr>


    @*---- أسطر ----*@
    @for (int i = 0; i < Model.Times.Count; i++)
    {
        <tr>
            @*---- أعمدة  ----*@
            @for (int j = 0; j < Model.Days.Count; j++)
            {
                var lucture = @Model?.Lectures?.FirstOrDefault(l => l.Time.Id == Model.Times[i].Id && l.day.DayNo == Model.Days[j].DayNo);
                if (lucture is not null)
                {
                    <td>
                        @lucture.course.Name <br>
                        @lucture.Room.Name <br>
                        د. @lucture.course.user.Name
                    </td>
                }
                else
                {
                    <td>
                    </td>
                }

                if (j == Model.Days.Count - 1)
                {
                    <td>
                        @Model.Times[i].Start <br>
                        @Model.Times[i].End
                    </td>
                }
            }
        </tr>
    }

</table>

<br>



@section Scripts {
    <script type="text/javascript" src="~/js/Admin/schedule.js"></script>
    }
